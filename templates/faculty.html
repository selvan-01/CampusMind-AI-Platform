{% extends "base.html" %}
{% block content %}

<!-- ================= HERO ================= -->
<div class="hero fade-in">
  <div class="hero-content">
    <h1><i class="fa-solid fa-user-tie"></i> Faculty Dashboard</h1>
    <p>Manage academic data, automate alerts & analyze performance</p>
  </div>
</div>


<!-- ================= QUICK ACTIONS ================= -->
<div class="section-title mt-40">
  <h2>âš¡ Quick Actions</h2>
</div>

<div class="action-row modern-actions">

  <a href="/faculty/send-attendance-warning" class="btn-gradient red">
    ğŸš¨ Attendance Warnings
  </a>

  <a href="/faculty/send-performance-warning" class="btn-gradient orange">
    ğŸ“‰ Performance Warnings
  </a>

  <a href="/faculty/send-exam-reminder" class="btn-gradient blue">
    ğŸ“© Exam Reminders
  </a>

  <a href="/faculty/download-class-report" class="btn-gradient green">
    ğŸ“„ Download Class Report
</a>


</div>

<a href="/faculty/students" class="btn-gradient blue">
    ğŸ‘¨â€ğŸ“ View Students
</a>

<!-- ================= FACULTY TOOLS ================= -->
<div class="section-title mt-50">
  <h2>ğŸ›  Faculty Tools</h2>
</div>

<div class="action-row">

  <a href="/faculty/manual-attendance" class="btn-gradient purple">
    â• Manual Attendance Entry
  </a>

  <a href="/faculty/internal-marks" class="btn-gradient teal">
    ğŸ§® Internal Marks Calculator
  </a>

</div>



<!-- ================= DATA UPLOAD ================= -->
<div class="section-title mt-50">
  <h2>ğŸ“‚ Upload Academic Data</h2>
</div>

<div class="grid">

  <div class="card">
    <h3>ğŸ‘¨â€ğŸ“ Upload Students</h3>
    <form method="POST" action="/upload_students" enctype="multipart/form-data">
      <input type="file" name="excel_file" required>
      <button type="submit" class="btn-small">Upload</button>
    </form>
  </div>

  <div class="card">
    <h3>ğŸ“Š Upload Attendance</h3>
    <form method="POST" action="/upload_attendance" enctype="multipart/form-data">
      <input type="file" name="excel_file" required>
      <button type="submit" class="btn-small">Upload</button>
    </form>
  </div>

  <div class="card">
    <h3>ğŸ“ Upload Marks</h3>
    <form method="POST" action="/upload_marks" enctype="multipart/form-data">
      <input type="file" name="excel_file" required>
      <button type="submit" class="btn-small">Upload</button>
    </form>
  </div>

</div>

<div class="card mt-30">
  <h3>ğŸ“… Upload Exam Schedule</h3>
  <form method="POST" action="/upload_exam" enctype="multipart/form-data">
    <input type="file" name="excel_file" required>
    <button type="submit" class="btn-small">Upload Exam Excel</button>
  </form>
</div>


<!-- ================= CLASS OVERVIEW ================= -->
<div class="section-title mt-50">
  <h2>ğŸ“Š Class Overview</h2>
</div>

<div class="grid">

  <div class="card stat-card">
    <h4>Total Students</h4>
    <h1 class="stat-blue">{{ total_students }}</h1>
  </div>

  <div class="card stat-card">
    <h4>Average Attendance</h4>
    <h1 class="stat-green">{{ avg_attendance }}%</h1>
  </div>

  <div class="card stat-card">
    <h4>Class Average Marks</h4>
    <h1 class="stat-purple">{{ avg_marks }}</h1>
  </div>

  <div class="card stat-card">
    <h4>Students At Risk</h4>
    <h1 class="stat-red">{{ risk_students|length }}</h1>
  </div>

</div>


<!-- ================= RISK DETAILS ================= -->
<div class="card mt-40 risk-card">
  <h3>âš  Students At Risk</h3>

  {% if risk_students %}
    <div class="risk-list">
      {% for s in risk_students %}
        <div class="risk-item">

          <!-- RED NAME -->
          <div class="risk-name">
            ğŸ”´ {{ s.name }}
          </div>

          <!-- REASON BADGE -->
          <div class="risk-reason">
            {{ s.reason }}
          </div>

        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="no-risk">âœ… No risk students ğŸ‰</p>
  {% endif %}
</div>


<!-- ================= AI ASSISTANT ================= -->
<div class="section-title mt-50">
  <h2>ğŸ¤– CampusMind AI Assistant</h2>
</div>

<div class="card fade-in">

  <p class="chat-subtitle">
    Full academic access enabled. Ask about students, attendance, marks, exams, or documents.
  </p>

  <div id="chatBox" class="chat-container">
    <div class="chat-row ai">
      <div class="chat-avatar">ğŸ¤–</div>
      <div class="chat-bubble ai">
        Hello Faculty ğŸ‘‹ I can help you with student and academic data.
      </div>
    </div>
  </div>

  <div class="chat-input-row">
    <input
      id="question"
      placeholder="e.g. Show CSE average attendance..."
      onkeydown="if(event.key==='Enter') sendMessage()"
    />
    <button onclick="sendMessage()">Send</button>
  </div>

</div>


<script>
function sendMessage() {
  const input = document.getElementById("question");
  const msg = input.value.trim();
  if (!msg) return;

  const chatBox = document.getElementById("chatBox");

  const userRow = document.createElement("div");
  userRow.className = "chat-row user";
  userRow.innerHTML = `
    <div class="chat-bubble user">${msg}</div>
    <div class="chat-avatar">ğŸ‘¨â€ğŸ«</div>
  `;
  chatBox.appendChild(userRow);

  input.value = "";
  chatBox.scrollTop = chatBox.scrollHeight;

  fetch("/chat", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: "question=" + encodeURIComponent(msg)
  })
  .then(res => res.text())
  .then(reply => {
    const aiRow = document.createElement("div");
    aiRow.className = "chat-row ai";
    aiRow.innerHTML = `
      <div class="chat-avatar">ğŸ¤–</div>
      <div class="chat-bubble ai">${reply}</div>
    `;
    chatBox.appendChild(aiRow);
    chatBox.scrollTop = chatBox.scrollHeight;
  });
}
</script>

{% endblock %}
